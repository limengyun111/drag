<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>drag</title>
  <link rel="stylesheet" href="./index.css" type="text/css">
  <script src="./index2.js"></script>
</head>

<body>

  <div class="wrap" id="wrapper">
    <div class="rect-wrap">
      <div class="rect-ele" id="scalable-ele-1">rect</div>
    </div>
    <div class="drag-wrap" id="draggable-ele-1">drag-ele</div>
    <div class="rect-wrap">
      <div class="rect-ele" id="scalable-ele-2">rect</div>
    </div>

  </div>




  <script>
    const wrapper = document.getElementById('wrapper');
    const dragEle = document.getElementById('draggable-ele-1');
    const leftScaleEle = document.getElementById('scalable-ele-1');
    const rightScaleEle = document.getElementById('scalable-ele-2');

    let minLeftWidth = 100;
    let minRightWidth = 100;

    const onMoveCallback = (offsetX) => {
      const curLeftScalePos = getScaleElePos(leftScaleEle);
      const curRightScalePos = getScaleElePos(rightScaleEle);

      if(curLeftScalePos.width <= 100 && offsetX < 0 || curRightScalePos.width <= 100 && offsetX > 0) {
        return false
      }
      // if (curLeftScalePos.width + offsetX > minLeftWidth && curRightScalePos.width - offsetX > minRightWidth) {
      //   return true;
      // }
      return true;
    }

    const dragEleInstance = new DragElement(dragEle, onMoveCallback);


    let translateRation;
    let childRatios = [];
    const dragWidth = 10;

    const getScaleElePos = (ele) => {
      const eleRect = ele.getBoundingClientRect();
      return {
        height: eleRect.height,
        width: eleRect.width,

      }
    };

    dragEleInstance.onMove = ((offsetX, offsetY, translateX) => {
      const curLeftScalePos = getScaleElePos(leftScaleEle);
      const curRightScalePos = getScaleElePos(rightScaleEle);
      const parentWidth = wrapper.clientWidth;

      leftScaleEle.style.width = curLeftScalePos.width + offsetX + 'px';
      rightScaleEle.style.width = curRightScalePos.width - offsetX + 'px';


      childRatios = updateRatios([leftScaleEle, rightScaleEle]);
      translateRation = translateX / parentWidth;
    });


    function updateRatios(children) {
      const parentWidth = wrapper.clientWidth;
      return Array.from(children).map(child => {
        return getScaleElePos(child).width / (parentWidth - dragWidth);
      });
    }


    const resizeObserver = new ResizeObserver((entries) => {

      const newParentWidth = entries[0].target.clientWidth;
      console.log('newParentWidth----', newParentWidth);
      const lastParentWidth = newParentWidth - dragWidth;
      [leftScaleEle, rightScaleEle].forEach((child, index) => {
        const newWidth = lastParentWidth * childRatios[index];
        child.style.width = `${newWidth}px`;
      });

      dragEle.style.transform = `translate(${newParentWidth * translateRation}px, ${0}px)`;
    });
    resizeObserver.observe(wrapper)


  </script>



</body>

</html>