<!DOCTYPE html>

<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>drag</title>
	<link rel="stylesheet" href="./index.css" type="text/css">
</head>

<body>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const ele = document.getElementById('draggable-ele');

			const getDragElePos = () => {
				const eleRect = ele.getBoundingClientRect();
				return {
					x: eleRect.width + eleRect.left,
					y: eleRect.height + eleRect.top,
					left: eleRect.left,
					top: eleRect.top
				}
			}


			const isMouseInRange = (mousePos) => {
				const elePos = getDragElePos();
				return mousePos.x - elePos.left > 0 && mousePos.y - elePos.top && elePos.x - mousePos.x > 0 && elePos.y - mousePos.y > 0;
			}


			let isBeginMove = false;
			let mouseBeginPos;
			let dragEleBeginPos;

			const setMoveBeginVal = (posX, posY) => {
				isBeginMove = true;
				mouseBeginPos = {
					x: posX,
					y: posY,
				};
				const elePos = getDragElePos();
				dragEleBeginPos = {
					x: elePos.left,
					y: elePos.top
				}
			}

			ele.addEventListener('touchstart', (event) => {
				const touch = event.touches[0];
				if (isMouseInRange({ x: touch.clientX, y: touch.clientY })) {
					setMoveBeginVal(touch.clientX, touch.clientY);
				}
			});
			ele.addEventListener('mousedown', (event) => {
				if (isMouseInRange(event)) {
					setMoveBeginVal(event.x, event.y);
				}
			});

			const setDragElePos = (curX, curY) => {
				const elePos = getDragElePos();
				ele.style.left = dragEleBeginPos.x + curX - mouseBeginPos.x + 'px';
				ele.style.top = dragEleBeginPos.y + curY - mouseBeginPos.y + 'px';
			}

			document.addEventListener('mousemove', (event) => {
				if (isMouseInRange(event)) {
					ele.style.cursor = 'move';
				} else {
					ele.style.cursor = 'pointer'
				};

				if (isBeginMove) {
					setDragElePos(event.x, event.y);
				}

			});

			document.addEventListener('touchmove', (event) => {
				// event.preventDefault();
				const touch = event.touches[0];
				if (isBeginMove) {
					setDragElePos(touch.clientX, touch.clientY);
				}
			});


			document.addEventListener('mouseup', (event) => {
				isBeginMove = false
			});
			document.addEventListener('touchend', (event) => {
				isBeginMove = false
			});

		});

	</script>

	<div class="drag-wrap" id="draggable-ele">
	</div>


</body>

</html>